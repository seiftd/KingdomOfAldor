# Kingdom of Aldoria - Storyline
# Epic fantasy story divided into three main sessions

STORYLINE = {
    "session_1": {
        "title": "The Awakening of the Shadow",
        "subtitle": "Discovery of the Ancient Threat",
        "chapters": [
            {
                "chapter": 1,
                "title": "The Peaceful Kingdom",
                "description": "In the prosperous Kingdom of Aldoria, Knight Arin serves as a guardian of peace. The realm has known tranquility for decades, with lush forests, golden fields, and thriving cities. But dark omens begin to appear...",
                "worlds_covered": ["Forest of Shadows"],
                "stages": "1-1 to 1-10",
                "key_events": [
                    "Introduction to Knight Arin and the kingdom",
                    "Strange shadows moving in the Forest of Shadows",
                    "First encounter with corrupted creatures",
                    "Discovery of ancient evil stirring"
                ]
            },
            {
                "chapter": 2,
                "title": "The Desert's Secret",
                "description": "Following clues from the forest, Arin ventures into the Desert of Souls, where ancient tombs hold secrets of a forgotten war. The sands whisper of an ancient evil that once threatened all realms.",
                "worlds_covered": ["Desert of Souls"],
                "stages": "2-1 to 2-10",
                "key_events": [
                    "Journey to the desert lands",
                    "Meeting with desert nomads and their warnings",
                    "Exploration of ancient burial sites",
                    "Discovery of the first Soul Crystal fragment"
                ]
            },
            {
                "chapter": 3,
                "title": "Mountains of Mystery",
                "description": "The crystal fragment leads Arin to the Frozen Peaks, where an ancient monastery holds the wisdom of the old guardians. Here, the true nature of the threat becomes clear - the Shadow Lord is awakening.",
                "worlds_covered": ["Frozen Peaks"],
                "stages": "3-1 to 3-10",
                "key_events": [
                    "Ascent of the treacherous mountains",
                    "Meeting with the Order of Crystal Guardians",
                    "Learning the history of the Shadow War",
                    "First boss battle: The Corrupted Guardian"
                ]
            }
        ],
        "session_conclusion": "Arin learns that the Shadow Lord, an ancient entity of pure darkness, is breaking free from his prison. The only way to stop him is to gather the seven Soul Crystals scattered across the ten realms. The first session ends with Arin accepting his destiny as the new Crystal Guardian."
    },
    
    "session_2": {
        "title": "The Crystal Hunt",
        "subtitle": "Gathering the Ancient Artifacts",
        "chapters": [
            {
                "chapter": 4,
                "title": "The Mystic Caverns",
                "description": "Deep underground, the Mystic Caverns hold the second Soul Crystal. But the darkness has already begun corrupting this realm, turning its crystal formations into deadly traps and its guardian spirits into hostile wraiths.",
                "worlds_covered": ["Mystic Caverns"],
                "stages": "4-1 to 4-10",
                "key_events": [
                    "Descent into the underground realm",
                    "Meeting Mage Lyra, who becomes an ally",
                    "Navigating crystal mazes and spectral dangers",
                    "Retrieving the second Soul Crystal"
                ]
            },
            {
                "chapter": 5,
                "title": "Flames of the Volcano",
                "description": "The Volcanic Realm burns with ancient fire magic. Here, Arin must prove worthy to the Fire Spirits while battling creatures of molten rock and shadow. The third Soul Crystal lies within the heart of the great volcano.",
                "worlds_covered": ["Volcanic Realm"],
                "stages": "5-1 to 5-10",
                "key_events": [
                    "Journey through rivers of lava",
                    "Alliance with the Fire Elemental tribes",
                    "Trial by fire to prove worthiness",
                    "Epic battle against the Lava Titan"
                ]
            },
            {
                "chapter": 6,
                "title": "Depths of the Ocean",
                "description": "Beneath the waves of the Underwater Kingdom, ancient leviathans guard the fourth Soul Crystal. Arin must learn to fight in this alien environment while uncovering the maritime civilization's tragic fall to the Shadow.",
                "worlds_covered": ["Underwater Kingdom"],
                "stages": "6-1 to 6-10",
                "key_events": [
                    "Acquiring magical breathing apparatus",
                    "Meeting Archer Finn among the sea-dwellers",
                    "Discovering the sunken palace",
                    "Confronting the Kraken of Shadows"
                ]
            },
            {
                "chapter": 7,
                "title": "Sky Islands of Wonder",
                "description": "High above the clouds, the Sky Islands float in eternal mist. The wind spirits here hold the fifth Soul Crystal, but they have been driven mad by whispers from the Shadow Realm.",
                "worlds_covered": ["Sky Islands"],
                "stages": "7-1 to 7-10",
                "key_events": [
                    "Learning to navigate floating platforms",
                    "Taming wind currents and storm eagles",
                    "Cleansing corrupted wind temples",
                    "Aerial combat with the Storm Lord"
                ]
            }
        ],
        "session_conclusion": "With five Soul Crystals gathered, Arin's power grows, but so does the Shadow Lord's influence. The corruption spreads faster across the realms, and time is running out. The party of heroes - Arin, Lyra, and Finn - prepare for the final phase of their quest."
    },
    
    "session_3": {
        "title": "The Final Confrontation",
        "subtitle": "Battle for the Soul of Aldoria",
        "chapters": [
            {
                "chapter": 8,
                "title": "The Twisted Forest",
                "description": "The once-beautiful Enchanted Forest has been completely corrupted by shadow magic. Trees have become monstrous beings, and the very air pulses with dark energy. The sixth Soul Crystal lies in the heart of this nightmare.",
                "worlds_covered": ["Enchanted Forest"],
                "stages": "8-1 to 8-10",
                "key_events": [
                    "Witnessing the complete corruption of nature",
                    "Recruiting Warrior Thor from the resistance",
                    "Battling through armies of shadow creatures",
                    "Confronting the corrupted World Tree"
                ]
            },
            {
                "chapter": 9,
                "title": "The Void Between Worlds",
                "description": "The Astral Plane exists between all realms, and here the Shadow Lord's power is strongest. Reality itself bends and twists as Arin seeks the seventh and final Soul Crystal in this realm of pure magic and chaos.",
                "worlds_covered": ["Astral Plane"],
                "stages": "9-1 to 9-10",
                "key_events": [
                    "Entering the realm of pure thought and energy",
                    "Facing manifestations of doubt and fear",
                    "Discovering the origin of the Soul Crystals",
                    "The ultimate test of worthiness"
                ]
            },
            {
                "chapter": 10,
                "title": "The Shadow Realm",
                "description": "In the final realm, the Shadow Lord awaits in his domain of eternal darkness. With all seven Soul Crystals united, Arin and the heroes make their final stand against the ancient evil that threatens to consume all existence.",
                "worlds_covered": ["Shadow Realm"],
                "stages": "10-1 to 10-15",
                "key_events": [
                    "Entering the heart of darkness itself",
                    "Confronting the Shadow Lord's generals",
                    "The revelation of the Shadow Lord's true identity",
                    "Epic final battle using the combined crystal power",
                    "The restoration of balance to all realms"
                ]
            }
        ],
        "session_conclusion": "The Shadow Lord is defeated, but not destroyed - for darkness is a part of the natural balance. Instead, he is bound once again, and the Soul Crystals are scattered to the worthy guardians of each realm. Arin becomes the new Guardian of the Balance, protecting Aldoria from future threats while the kingdom enters a new golden age."
    }
}

# Story progression tracking
STORY_PROGRESSION = {
    "current_session": 1,
    "current_chapter": 1,
    "unlocked_lore": [],
    "character_relationships": {
        "lyra_trust": 0,
        "finn_friendship": 0,
        "thor_respect": 0
    },
    "world_corruption_levels": {
        "forest_of_shadows": 10,
        "desert_of_souls": 5,
        "frozen_peaks": 0,
        "mystic_caverns": 0,
        "volcanic_realm": 0,
        "underwater_kingdom": 0,
        "sky_islands": 0,
        "enchanted_forest": 0,
        "astral_plane": 0,
        "shadow_realm": 100
    }
}

# Lore entries unlocked through gameplay
LORE_ENTRIES = {
    "ancient_war": {
        "title": "The First Shadow War",
        "content": "Long ago, when the realms were young, a great war was fought between the forces of light and shadow. The Shadow Lord, born from the collective fears and darkness of all living beings, sought to consume all creation. Only the combined power of the seven Soul Crystals could bind him.",
        "unlock_condition": "Complete Chapter 1"
    },
    "crystal_guardians": {
        "title": "The Order of Crystal Guardians",
        "content": "An ancient order dedicated to protecting the Soul Crystals and maintaining the balance between light and shadow. Each guardian is chosen not for their strength, but for their pure heart and unwavering determination to protect others.",
        "unlock_condition": "Meet the Order in Chapter 3"
    },
    "soul_crystals": {
        "title": "The Seven Soul Crystals",
        "content": "Forged from the essence of the first beings to ever exist, the Soul Crystals contain pure life energy. Each crystal represents a fundamental aspect of existence: Hope, Courage, Wisdom, Love, Justice, Harmony, and Unity.",
        "unlock_condition": "Collect first Soul Crystal"
    },
    "shadow_lord_origin": {
        "title": "The Shadow Lord's True Nature",
        "content": "The Shadow Lord was not always evil. He was once the Guardian of Necessary Darkness - the shadow that gives meaning to light, the fear that makes courage precious. But isolation and the weight of being misunderstood corrupted him into pure malevolence.",
        "unlock_condition": "Reach Chapter 10"
    }
}

def get_current_story_text(session, chapter):
    """Get the story text for the current session and chapter"""
    if session in STORYLINE and chapter <= len(STORYLINE[session]["chapters"]):
        return STORYLINE[session]["chapters"][chapter - 1]
    return None

def unlock_lore_entry(entry_key, player_data):
    """Unlock a lore entry and add it to player's collection"""
    if entry_key in LORE_ENTRIES and entry_key not in player_data.get("unlocked_lore", []):
        if "unlocked_lore" not in player_data:
            player_data["unlocked_lore"] = []
        player_data["unlocked_lore"].append(entry_key)
        return True
    return False

def get_session_progress_percentage(session, current_chapter):
    """Calculate the progress percentage for a session"""
    if session in STORYLINE:
        total_chapters = len(STORYLINE[session]["chapters"])
        return min(100, (current_chapter / total_chapters) * 100)
    return 0